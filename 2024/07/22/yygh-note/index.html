<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="SleepingFace Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="http://localhost:1313//img/home1.jpg">
    <meta property="twitter:image" content="http://localhost:1313//img/home1.jpg" />
    

    
    <meta name="title" content="尚医通项目笔记(一)" />
    <meta property="og:title" content="尚医通项目笔记(一)" />
    <meta property="twitter:title" content="尚医通项目笔记(一)" />
    

    
    <meta name="description" content="学习尚医通开源项目的过程笔记.">
    <meta property="og:description" content="学习尚医通开源项目的过程笔记." />
    <meta property="twitter:description" content="学习尚医通开源项目的过程笔记." />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="WangZhendong">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>尚医通项目笔记(一) | 王振东的博客 | WangZhendong Blog</title>

    <link rel="canonical" href="/2024/07/22/yygh-note/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link rel="stylesheet" href="/css/font-awesome.all.min.css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>






<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">SleepingFace Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">All Posts</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/tech/">tech</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/archive//">ARCHIVE</a></li>
                    
                        <li><a href="/notes//">NOTES</a></li>
                    
                        <li><a href="/about//">ABOUT</a></li>
                    
		            <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/home1.jpg')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/java" title="Java">
                            Java
                        </a>
                        
                        <a class="tag" href="/tags/mongodb" title="MongoDB">
                            MongoDB
                        </a>
                        
                        <a class="tag" href="/tags/mysql" title="MySQL">
                            MySQL
                        </a>
                        
                        <a class="tag" href="/tags/redis" title="Redis">
                            Redis
                        </a>
                        
                        <a class="tag" href="/tags/kafka" title="Kafka">
                            Kafka
                        </a>
                        
                        <a class="tag" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1" title="微服务">
                            微服务
                        </a>
                        
                    </div>
                    <h1>尚医通项目笔记(一)</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                SleepingFace
                             
                            on 
                            Monday, July 22, 2024
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <h1 id="1预约挂号微服务模块搭建">1.预约挂号微服务模块搭建</h1>
<h2 id="项目模块构建">项目模块构建</h2>
<p>hospital-manage：医院接口模拟端（已开发，直接使用）</p>
<p>yygh-parent：根目录，管理子模块：</p>
<p>common：公共模块父节点</p>
<ul>
<li>
<p>common-util：工具类模块，所有模块都可以依赖于它</p>
</li>
<li>
<p>rabbit-util：rabbitmq业务封装</p>
</li>
<li>
<p>service-util：service服务的工具包，包含service服务的公共配置类，所有              service模块依赖于它</p>
</li>
</ul>
<p>server-gateway：服务网关</p>
<p>model：实体类模块</p>
<p>service：api接口服务父节点</p>
<ul>
<li>service-hosp：医院api接口服务</li>
<li>service-cmn：公共api接口服务</li>
<li>service-user：用户api接口服务</li>
<li>service-order：订单api接口服务</li>
<li>service-oss：文件api接口服务</li>
<li>service-sms：短信 api接口服务</li>
<li>service-task：定时任务服务</li>
<li>service-statistics：统计api接口服务</li>
</ul>
<p>service-client：feign服务调用父节点</p>
<ul>
<li>
<p>service-cmn-client：公共api接口</p>
</li>
<li>
<p>service-hosp-client：医院api接口</p>
</li>
<li>
<p>service-order-client：订单api接口</p>
</li>
</ul>
<h1 id="2后台系统-医院设置需求">2.后台系统-医院设置需求</h1>
<p>医院设置主要是用来保存开通医院的一些基本信息，每个医院一条信息，保存了医院编号（平台分配，全局唯一）和接口调用相关的签名key等信息，是整个流程的第一步，只有开通了医院设置信息，才可以上传医院相关信息。</p>
<p>我们所开发的功能就是基于单表的一个CRUD、锁定/解锁和发送签名信息这些基本功能。</p>
<h2 id="表结构">表结构</h2>
<p>hosname：医院名称</p>
<p>hoscode：医院编号（平台分配，全局唯一，api接口必填信息）</p>
<p>api_url：医院回调的基础url（如：预约下单，我们要调用该地址去医院下单）</p>
<p>sign_key：双方api接口调用的签名key，有平台生成</p>
<p>contacts_name：医院联系人姓名</p>
<p>contacts_phone：医院联系人手机</p>
<p>status：状态（锁定/解锁）</p>
<h2 id="21医院设置crud">2.1医院设置CRUD</h2>
<h3 id="baseentity">BaseEntity</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">BaseEntity</span> <span style="color:#8be9fd;font-style:italic">implements</span> Serializable {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableId(type <span style="color:#ff79c6">=</span> IdType.<span style="color:#50fa7b">AUTO</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Long id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;创建时间&#34;</span>)
</span></span><span style="display:flex;"><span>    @JsonFormat(pattern <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;yyyy-MM-dd HH:mm:ss&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;create_time&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//    @TableField(fill = FieldFill.INSERT) ////////////////</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Date createTime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;更新时间&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;update_time&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//    @TableField(fill = FieldFill.INSERT_UPDATE) ///////////////////</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Date updateTime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;逻辑删除(1:已删除，0:未删除)&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableLogic     <span style="color:#6272a4">////////////////////////</span>
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;is_deleted&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Integer isDeleted;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;其他参数&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(exist <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>) <span style="color:#6272a4">/////////////////////</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Map<span style="color:#ff79c6">&lt;</span>String,Object<span style="color:#ff79c6">&gt;</span> param <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> HashMap<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="tablefieldfill--fieldfillxx使用指南">@TableField(fill = FieldFill.xx)使用指南</h4>
<p>如果使用**@TableField(fill = FieldFill.INSERT)<strong>和</strong>@TableField(fill = FieldFill.INSERT_UPDATE)**需要进行如下配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MybatisplusConfig</span> <span style="color:#8be9fd;font-style:italic">implements</span> MetaObjectHandler {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">insertFill</span>(MetaObject metaObject) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">setFieldValByName</span>(<span style="color:#f1fa8c">&#34;createTime&#34;</span>, <span style="color:#ff79c6">new</span> Date(), metaObject);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">setFieldValByName</span>(<span style="color:#f1fa8c">&#34;updateTime&#34;</span>, <span style="color:#ff79c6">new</span> Date(), metaObject);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">updateFill</span>(MetaObject metaObject) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">setFieldValByName</span>(<span style="color:#f1fa8c">&#34;updateTime&#34;</span>, <span style="color:#ff79c6">new</span> Date(), metaObject);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="hospitalset">HospitalSet</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span>@ApiModel(description <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院设置&#34;</span>)
</span></span><span style="display:flex;"><span>@TableName(<span style="color:#f1fa8c">&#34;hospital_set&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">HospitalSet</span> <span style="color:#8be9fd;font-style:italic">extends</span> BaseEntity {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">long</span> serialVersionUID <span style="color:#ff79c6">=</span> 1L;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院名称&#34;</span>)
</span></span><span style="display:flex;"><span>	@TableField(<span style="color:#f1fa8c">&#34;hosname&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> String hosname;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院编号&#34;</span>)
</span></span><span style="display:flex;"><span>	@TableField(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> String hoscode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;api基础路径&#34;</span>)
</span></span><span style="display:flex;"><span>	@TableField(<span style="color:#f1fa8c">&#34;api_url&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> String apiUrl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;签名秘钥&#34;</span>)
</span></span><span style="display:flex;"><span>	@TableField(<span style="color:#f1fa8c">&#34;sign_key&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> String signKey;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;联系人姓名&#34;</span>)
</span></span><span style="display:flex;"><span>	@TableField(<span style="color:#f1fa8c">&#34;contacts_name&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> String contactsName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;联系人手机&#34;</span>)
</span></span><span style="display:flex;"><span>	@TableField(<span style="color:#f1fa8c">&#34;contacts_phone&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> String contactsPhone;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;状态&#34;</span>)
</span></span><span style="display:flex;"><span>	@TableField(<span style="color:#f1fa8c">&#34;status&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> Integer status;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="hospitalsetqueyvo">HospitalSetQueyVo</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">HospitalSetQueryVo</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院名称&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String hosname;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院编号&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String hoscode;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="一个tips">一个tips</h3>
<p>**注意：<strong>要在启动类上加入</strong>@ComponentScan(basePackages = &ldquo;com.atguigu&rdquo;)**注解，才能使用其它模块下的配置类。</p>
<h3 id="hospitalsetcontroller层代码">HospitalSetController层代码</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span>@RequestMapping(<span style="color:#f1fa8c">&#34;/admin/hosp/hospitalSet&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">HospitalSetController</span> {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> HospitalSetService hospitalSetService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//1 查询医院设置表所有信息</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;获取所有医院设置&#34;</span>)
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#f1fa8c">&#34;findAll&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">findAllHosptialSet</span>() {
</span></span><span style="display:flex;"><span>        List<span style="color:#ff79c6">&lt;</span>HospitalSet<span style="color:#ff79c6">&gt;</span> list <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">list</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>(list);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//2 逻辑删除医院设置</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;逻辑删除医院设置&#34;</span>)
</span></span><span style="display:flex;"><span>    @DeleteMapping(<span style="color:#f1fa8c">&#34;{id}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">removeHospSet</span>(@PathVariable Long id) {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">boolean</span> flag <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">removeById</span>(id);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (flag) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>        }<span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//3 条件查询带分页</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;条件查询带分页&#34;</span>)
</span></span><span style="display:flex;"><span>    @PostMapping(<span style="color:#f1fa8c">&#34;findPageHospSet/{current}/{limit}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">findPageHospSet</span>(@PathVariable <span style="color:#8be9fd">long</span> current,
</span></span><span style="display:flex;"><span>                                  @PathVariable <span style="color:#8be9fd">long</span> limit,
</span></span><span style="display:flex;"><span>                                  @RequestBody(required <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>) HospitalSetQueryVo hospitalSetQueryVo) {
</span></span><span style="display:flex;"><span>        Page<span style="color:#ff79c6">&lt;</span>HospitalSet<span style="color:#ff79c6">&gt;</span> page <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Page<span style="color:#ff79c6">&lt;&gt;</span>(current,limit);
</span></span><span style="display:flex;"><span>        String hosname <span style="color:#ff79c6">=</span> hospitalSetQueryVo.<span style="color:#50fa7b">getHosname</span>();
</span></span><span style="display:flex;"><span>        String hoscode <span style="color:#ff79c6">=</span> hospitalSetQueryVo.<span style="color:#50fa7b">getHoscode</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        QueryWrapper<span style="color:#ff79c6">&lt;</span>HospitalSet<span style="color:#ff79c6">&gt;</span> wrapper <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> QueryWrapper<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>StringUtils.<span style="color:#50fa7b">isEmpty</span>(hosname)) {
</span></span><span style="display:flex;"><span>            wrapper.<span style="color:#50fa7b">like</span>(<span style="color:#f1fa8c">&#34;hosname&#34;</span>,hosname);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>StringUtils.<span style="color:#50fa7b">isEmpty</span>(hoscode)) {
</span></span><span style="display:flex;"><span>            wrapper.<span style="color:#50fa7b">eq</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>,hoscode);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Page<span style="color:#ff79c6">&lt;</span>HospitalSet<span style="color:#ff79c6">&gt;</span> hospitalSetPage <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">page</span>(page, wrapper);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>(hospitalSetPage);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//4 添加医院设置</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;添加医院设置&#34;</span>)
</span></span><span style="display:flex;"><span>    @PostMapping(<span style="color:#f1fa8c">&#34;saveHospitalSet&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">saveHospitalSet</span>(@RequestBody HospitalSet hospitalSet) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//设置状态 1 使用 0 不能使用</span>
</span></span><span style="display:flex;"><span>        hospitalSet.<span style="color:#50fa7b">setStatus</span>(1);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//签名秘钥</span>
</span></span><span style="display:flex;"><span>        Random random  <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Random();
</span></span><span style="display:flex;"><span>        hospitalSet.<span style="color:#50fa7b">setSignKey</span>(MD5.<span style="color:#50fa7b">encrypt</span>(System.<span style="color:#50fa7b">currentTimeMillis</span>()<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34;&#34;</span><span style="color:#ff79c6">+</span> random.<span style="color:#50fa7b">nextInt</span>(1000)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">boolean</span> flag <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">save</span>(hospitalSet);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (flag) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//5 根据id获取医院设置</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;根据id获取医院设置&#34;</span>)
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#f1fa8c">&#34;getHospSet/{id}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">getHospSet</span>(@PathVariable Long id) {
</span></span><span style="display:flex;"><span>        HospitalSet hospitalSet <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">getById</span>(id);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (hospitalSet <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>(hospitalSet);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//6 修改医院设置</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;修改医院设置&#34;</span>)
</span></span><span style="display:flex;"><span>    @PostMapping(<span style="color:#f1fa8c">&#34;updateHospitalSet&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">updateHospitalSet</span>(@RequestBody HospitalSet hospitalSet) {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">boolean</span> flag <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">updateById</span>(hospitalSet);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (flag) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//7 批量删除医院设置</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;批量删除医院设置&#34;</span>)
</span></span><span style="display:flex;"><span>    @DeleteMapping(<span style="color:#f1fa8c">&#34;batchRemove&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">batchRemoveHospitalSet</span>(@RequestBody List<span style="color:#ff79c6">&lt;</span>Long<span style="color:#ff79c6">&gt;</span> ids) {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">boolean</span> flag <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">removeByIds</span>(ids);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (flag) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//8 医院设置锁定和解锁</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院设置锁定和解锁&#34;</span>)
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#f1fa8c">&#34;lock/{id}/{status}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">lockHospitalSet</span>(@PathVariable(<span style="color:#f1fa8c">&#34;id&#34;</span>) String id,
</span></span><span style="display:flex;"><span>                       @PathVariable(<span style="color:#f1fa8c">&#34;status&#34;</span>) Integer status) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> hospitalSetService.<span style="color:#50fa7b">lock</span>(id,status);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//9 发送签名秘钥</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;发送签名秘钥&#34;</span>)
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#f1fa8c">&#34;sendKey/{id}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">sendKey</span>(@PathVariable(<span style="color:#f1fa8c">&#34;id&#34;</span>) String id) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> hospitalSetService.<span style="color:#50fa7b">sendKey</span>(id);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="hospitalsetserviceimpl层代码">HospitalSetServiceImpl层代码</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">HospitalSetServiceImpl</span> <span style="color:#8be9fd;font-style:italic">extends</span> ServiceImpl<span style="color:#ff79c6">&lt;</span>HospitalSetMapper, HospitalSet<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">implements</span> HospitalSetService {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">lock</span>(String id, Integer status) {
</span></span><span style="display:flex;"><span>        HospitalSet hospitalSet <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">getById</span>(id);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (hospitalSet <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        hospitalSet.<span style="color:#50fa7b">setStatus</span>(status);
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">boolean</span> flag <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">updateById</span>(hospitalSet);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (flag) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">sendKey</span>(String id) {
</span></span><span style="display:flex;"><span>        HospitalSet hospitalSet <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">getById</span>(id);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (hospitalSet <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        String signKey <span style="color:#ff79c6">=</span> hospitalSet.<span style="color:#50fa7b">getSignKey</span>();
</span></span><span style="display:flex;"><span>        String hoscode <span style="color:#ff79c6">=</span> hospitalSet.<span style="color:#50fa7b">getHoscode</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//TODO 发送短信</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="3全局异常处理">3.全局异常处理</h1>
<h2 id="统一异常处理">统一异常处理</h2>
<p>common_util -&gt; exception -&gt; GlobalExceptionHandler</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RestControllerAdvice
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">GlobalExceptionHandler</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ExceptionHandler(Exception.<span style="color:#50fa7b">class</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">error</span>(Exception e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#50fa7b">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ExceptionHandler(YyghException.<span style="color:#50fa7b">class</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">error</span>(YyghException e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#50fa7b">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="自定义异常处理">自定义异常处理</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span>@ApiModel(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;自定义全局异常类&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">YyghException</span> <span style="color:#8be9fd;font-style:italic">extends</span> RuntimeException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;异常状态码&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Integer code;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 通过状态码和错误消息创建异常对象
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @param message
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @param code
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#50fa7b">YyghException</span>(String message, Integer code) {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">super</span>(message);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">code</span> <span style="color:#ff79c6">=</span> code;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 接收枚举类型对象
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @param resultCodeEnum
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#50fa7b">YyghException</span>(ResultCodeEnum resultCodeEnum) {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">super</span>(resultCodeEnum.<span style="color:#50fa7b">getMessage</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">code</span> <span style="color:#ff79c6">=</span> resultCodeEnum.<span style="color:#50fa7b">getCode</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">toString</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;YyghException{&#34;</span> <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f1fa8c">&#34;code=&#34;</span> <span style="color:#ff79c6">+</span> code <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f1fa8c">&#34;, message=&#34;</span> <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">getMessage</span>() <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f1fa8c">&#39;}&#39;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="4统一日志处理">4.统一日志处理</h1>
<p><strong>resources/logback-spring.xml</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#ff79c6">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;configuration</span>  <span style="color:#50fa7b">scan=</span><span style="color:#f1fa8c">&#34;true&#34;</span> <span style="color:#50fa7b">scanPeriod=</span><span style="color:#f1fa8c">&#34;10 seconds&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 日志级别从低到高分为TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL，如果设置为WARN，则低于WARN的信息都不会输出 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- scan:当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒。当scan为true时，此属性生效。默认的时间间隔为1分钟。 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- debug:当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为false。 --&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;contextName&gt;</span>logback<span style="color:#ff79c6">&lt;/contextName&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- name的值是变量的名称，value的值时变量定义的值。通过定义的值会被插入到logger上下文中。定义变量后，可以使“${}”来使用变量。 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">&lt;!--    &lt;property name=&#34;log.path&#34; value=&#34;D:/yygh_log/edu&#34; /&gt;--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;log.path&#34;</span> <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;D:/BaiduNetdiskDownload/heima/yygh_log/edu&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 彩色日志 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 配置格式变量：CONSOLE_LOG_PATTERN 彩色日志格式 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- magenta:洋红 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- boldMagenta:粗红--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- cyan:青色 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- white:白色 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- magenta:洋红 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;property</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;CONSOLE_LOG_PATTERN&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#50fa7b">value=</span><span style="color:#f1fa8c">&#34;%yellow(%date{yyyy-MM-dd HH:mm:ss}) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)&#34;</span><span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!--输出到控制台--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;appender</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;CONSOLE&#34;</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 例如：如果此处配置了INFO级别，则后面其他位置即使配置了DEBUG级别的日志，也不会被输出 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;filter</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.classic.filter.ThresholdFilter&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;level&gt;</span>INFO<span style="color:#ff79c6">&lt;/level&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/filter&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;encoder&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;Pattern&gt;</span>${CONSOLE_LOG_PATTERN}<span style="color:#ff79c6">&lt;/Pattern&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">&lt;!-- 设置字符集 --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;charset&gt;</span>UTF-8<span style="color:#ff79c6">&lt;/charset&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/encoder&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!--输出到文件--&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 时间滚动输出 level为 INFO 日志 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;appender</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;INFO_FILE&#34;</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;file&gt;</span>${log.path}/log_info.log<span style="color:#ff79c6">&lt;/file&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!--日志文件输出格式--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;encoder&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;pattern&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span style="color:#ff79c6">&lt;/pattern&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;charset&gt;</span>UTF-8<span style="color:#ff79c6">&lt;/charset&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/encoder&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;rollingPolicy</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">&lt;!-- 每天日志归档路径以及格式 --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;fileNamePattern&gt;</span>${log.path}/info/log-info-%d{yyyy-MM-dd}.%i.log<span style="color:#ff79c6">&lt;/fileNamePattern&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;timeBasedFileNamingAndTriggeringPolicy</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;maxFileSize&gt;</span>100MB<span style="color:#ff79c6">&lt;/maxFileSize&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">&lt;!--日志文件保留天数--&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;maxHistory&gt;</span>15<span style="color:#ff79c6">&lt;/maxHistory&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/rollingPolicy&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 此日志文件只记录info级别的 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;filter</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.classic.filter.LevelFilter&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;level&gt;</span>INFO<span style="color:#ff79c6">&lt;/level&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;onMatch&gt;</span>ACCEPT<span style="color:#ff79c6">&lt;/onMatch&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;onMismatch&gt;</span>DENY<span style="color:#ff79c6">&lt;/onMismatch&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/filter&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 时间滚动输出 level为 WARN 日志 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;appender</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;WARN_FILE&#34;</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;file&gt;</span>${log.path}/log_warn.log<span style="color:#ff79c6">&lt;/file&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!--日志文件输出格式--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;encoder&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;pattern&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span style="color:#ff79c6">&lt;/pattern&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;charset&gt;</span>UTF-8<span style="color:#ff79c6">&lt;/charset&gt;</span> <span style="color:#6272a4">&lt;!-- 此处设置字符集 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/encoder&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;rollingPolicy</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;fileNamePattern&gt;</span>${log.path}/warn/log-warn-%d{yyyy-MM-dd}.%i.log<span style="color:#ff79c6">&lt;/fileNamePattern&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;timeBasedFileNamingAndTriggeringPolicy</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;maxFileSize&gt;</span>100MB<span style="color:#ff79c6">&lt;/maxFileSize&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">&lt;!--日志文件保留天数--&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;maxHistory&gt;</span>15<span style="color:#ff79c6">&lt;/maxHistory&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/rollingPolicy&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 此日志文件只记录warn级别的 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;filter</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.classic.filter.LevelFilter&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;level&gt;</span>warn<span style="color:#ff79c6">&lt;/level&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;onMatch&gt;</span>ACCEPT<span style="color:#ff79c6">&lt;/onMatch&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;onMismatch&gt;</span>DENY<span style="color:#ff79c6">&lt;/onMismatch&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/filter&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 时间滚动输出 level为 ERROR 日志 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;appender</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;ERROR_FILE&#34;</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;file&gt;</span>${log.path}/log_error.log<span style="color:#ff79c6">&lt;/file&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!--日志文件输出格式--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;encoder&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;pattern&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n<span style="color:#ff79c6">&lt;/pattern&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;charset&gt;</span>UTF-8<span style="color:#ff79c6">&lt;/charset&gt;</span> <span style="color:#6272a4">&lt;!-- 此处设置字符集 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/encoder&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;rollingPolicy</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;fileNamePattern&gt;</span>${log.path}/error/log-error-%d{yyyy-MM-dd}.%i.log<span style="color:#ff79c6">&lt;/fileNamePattern&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;timeBasedFileNamingAndTriggeringPolicy</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;maxFileSize&gt;</span>100MB<span style="color:#ff79c6">&lt;/maxFileSize&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">&lt;!--日志文件保留天数--&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;maxHistory&gt;</span>15<span style="color:#ff79c6">&lt;/maxHistory&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/rollingPolicy&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!-- 此日志文件只记录ERROR级别的 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;filter</span> <span style="color:#50fa7b">class=</span><span style="color:#f1fa8c">&#34;ch.qos.logback.classic.filter.LevelFilter&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;level&gt;</span>ERROR<span style="color:#ff79c6">&lt;/level&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;onMatch&gt;</span>ACCEPT<span style="color:#ff79c6">&lt;/onMatch&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;onMismatch&gt;</span>DENY<span style="color:#ff79c6">&lt;/onMismatch&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/filter&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/appender&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        &lt;logger&gt;用来设置某一个包或者具体的某一个类的日志打印级别、以及指定&lt;appender&gt;。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        &lt;logger&gt;仅有一个name属性，
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        一个可选的level和一个可选的addtivity属性。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        name:用来指定受此logger约束的某一个包或者具体的某一个类。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">              如果未设置此属性，那么当前logger将会继承上级的级别。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        使用mybatis的时候，sql语句是debug下才会打印，而这里我们只配置了info，所以想要查看sql语句的话，有以下两种操作：
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        第一种把&lt;root level=&#34;INFO&#34;&gt;改成&lt;root level=&#34;DEBUG&#34;&gt;这样就会打印sql，不过这样日志那边会出现很多其他消息
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        第二种就是单独给mapper下目录配置DEBUG模式，代码如下，这样配置sql语句会打印，其他还是正常DEBUG级别：
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!--开发环境:打印控制台--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;springProfile</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;dev&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!--可以输出项目中的debug日志，包括mybatis的sql日志--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;logger</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;com.guli&#34;</span> <span style="color:#50fa7b">level=</span><span style="color:#f1fa8c">&#34;INFO&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">            root节点是必选节点，用来指定最基础的日志输出级别，只有一个level属性
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">            level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，默认是DEBUG
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">            可以包含零个或多个appender元素。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">        --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;root</span> <span style="color:#50fa7b">level=</span><span style="color:#f1fa8c">&#34;INFO&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;appender-ref</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;CONSOLE&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;appender-ref</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;INFO_FILE&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;appender-ref</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;WARN_FILE&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;appender-ref</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;ERROR_FILE&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/root&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/springProfile&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!--生产环境:输出到文件--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;springProfile</span> <span style="color:#50fa7b">name=</span><span style="color:#f1fa8c">&#34;pro&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;root</span> <span style="color:#50fa7b">level=</span><span style="color:#f1fa8c">&#34;INFO&#34;</span><span style="color:#ff79c6">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;appender-ref</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;CONSOLE&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;appender-ref</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;DEBUG_FILE&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;appender-ref</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;INFO_FILE&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;appender-ref</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;ERROR_FILE&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;appender-ref</span> <span style="color:#50fa7b">ref=</span><span style="color:#f1fa8c">&#34;WARN_FILE&#34;</span> <span style="color:#ff79c6">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/root&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/springProfile&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span></code></pre></div><h1 id="5数据字典">5.数据字典</h1>
<p><strong>上级id，通过id与parent_id构建上下级关系</strong></p>
<h2 id="dict实体类">Dict实体类</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span>@ApiModel(description <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;数据字典&#34;</span>)
</span></span><span style="display:flex;"><span>@TableName(<span style="color:#f1fa8c">&#34;dict&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Dict</span> { <span style="color:#6272a4">//不继承baseEntity</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">long</span> serialVersionUID <span style="color:#ff79c6">=</span> 1L;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;id&#34;</span>) <span style="color:#6272a4">//去掉了自动增长</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Long id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;创建时间&#34;</span>)
</span></span><span style="display:flex;"><span>    @JsonFormat(pattern <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;yyyy-MM-dd HH:mm:ss&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;create_time&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Date createTime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;更新时间&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;update_time&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Date updateTime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;逻辑删除(1:已删除，0:未删除)&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableLogic
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;is_deleted&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Integer isDeleted;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;其他参数&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(exist <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Map<span style="color:#ff79c6">&lt;</span>String,Object<span style="color:#ff79c6">&gt;</span> param <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> HashMap<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;上级id&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;parent_id&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> Long parentId;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;名称&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;name&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;值&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;value&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;编码&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(<span style="color:#f1fa8c">&#34;dict_code&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String dictCode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;是否包含子节点&#34;</span>)
</span></span><span style="display:flex;"><span>    @TableField(exist <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> hasChildren;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="dicteevo">DictEeVo</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">DictEeVo</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ExcelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;id&#34;</span> ,index <span style="color:#ff79c6">=</span> 0)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> Long id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ExcelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;上级id&#34;</span> ,index <span style="color:#ff79c6">=</span> 1)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> Long parentId;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ExcelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;名称&#34;</span> ,index <span style="color:#ff79c6">=</span> 2)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> String name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ExcelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;值&#34;</span> ,index <span style="color:#ff79c6">=</span> 3)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> String value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	@ExcelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;编码&#34;</span> ,index <span style="color:#ff79c6">=</span> 4)
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">private</span> String dictCode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="51数据字典接口实现">5.1数据字典接口实现</h2>
<p><strong>DictController</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Api(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;数据字典接口&#34;</span>)
</span></span><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span>@RequestMapping(<span style="color:#f1fa8c">&#34;/admin/cmn/dict&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">DictController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> DictService dictService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//根据数据id查询子数据列表</span>
</span></span><span style="display:flex;"><span>    @ApiOperation(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;根据数据id查询子数据列表&#34;</span>)
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#f1fa8c">&#34;findChildData/{id}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">findChildData</span>(@PathVariable Long id) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List<span style="color:#ff79c6">&lt;</span>Dict<span style="color:#ff79c6">&gt;</span> list <span style="color:#ff79c6">=</span> dictService.<span style="color:#50fa7b">findChildData</span>(id);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>(list);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>DictServiceImpl</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">DictServiceImpl</span> <span style="color:#8be9fd;font-style:italic">extends</span> ServiceImpl<span style="color:#ff79c6">&lt;</span>DictMapper, Dict<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">implements</span> DictService {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> List<span style="color:#ff79c6">&lt;</span>Dict<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">findChildData</span>(Long id) {
</span></span><span style="display:flex;"><span>        QueryWrapper<span style="color:#ff79c6">&lt;</span>Dict<span style="color:#ff79c6">&gt;</span> wrapper <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> QueryWrapper<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#50fa7b">eq</span>(<span style="color:#f1fa8c">&#34;parent_id&#34;</span>,id);
</span></span><span style="display:flex;"><span>        List<span style="color:#ff79c6">&lt;</span>Dict<span style="color:#ff79c6">&gt;</span> dictList <span style="color:#ff79c6">=</span> baseMapper.<span style="color:#50fa7b">selectList</span>(wrapper).<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">map</span>(dict <span style="color:#ff79c6">-&gt;</span> {
</span></span><span style="display:flex;"><span>            Long dictId <span style="color:#ff79c6">=</span> dict.<span style="color:#50fa7b">getId</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd">boolean</span> isChild <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">isChildren</span>(dictId);
</span></span><span style="display:flex;"><span>            dict.<span style="color:#50fa7b">setHasChildren</span>(isChild);
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> dict;
</span></span><span style="display:flex;"><span>        }).<span style="color:#50fa7b">collect</span>(Collectors.<span style="color:#50fa7b">toList</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> dictList;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//是否有下级</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">isChildren</span>(Long dictId) {
</span></span><span style="display:flex;"><span>        QueryWrapper<span style="color:#ff79c6">&lt;</span>Dict<span style="color:#ff79c6">&gt;</span> wrapper <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> QueryWrapper<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#50fa7b">eq</span>(<span style="color:#f1fa8c">&#34;parent_id&#34;</span>,dictId);
</span></span><span style="display:flex;"><span>        Integer count <span style="color:#ff79c6">=</span> baseMapper.<span style="color:#50fa7b">selectCount</span>(wrapper);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> count <span style="color:#ff79c6">&gt;</span> 0;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="52easyexcel">5.2EasyExcel</h2>
<h3 id="数据字典导出">数据字典导出</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//**DictController**</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//导出数据字典接口</span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#f1fa8c">&#34;exportData&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">exportDict</span>(HttpServletResponse response) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> dictService.<span style="color:#50fa7b">exportDict</span>(response);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//**DictServiceImpl**</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">exportDict</span>(HttpServletResponse response) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//设置下载信息</span>
</span></span><span style="display:flex;"><span>        response.<span style="color:#50fa7b">setContentType</span>(<span style="color:#f1fa8c">&#34;application/vnd.ms-excel&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#50fa7b">setCharacterEncoding</span>(<span style="color:#f1fa8c">&#34;utf-8&#34;</span>);
</span></span><span style="display:flex;"><span>        String fileName <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;dict&#34;</span>;
</span></span><span style="display:flex;"><span>        response.<span style="color:#50fa7b">setHeader</span>(<span style="color:#f1fa8c">&#34;Content-disposition&#34;</span>, <span style="color:#f1fa8c">&#34;attachment;filename=&#34;</span><span style="color:#ff79c6">+</span> fileName <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;.xlsx&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List<span style="color:#ff79c6">&lt;</span>DictEeVo<span style="color:#ff79c6">&gt;</span> dictEeVoList <span style="color:#ff79c6">=</span> baseMapper.<span style="color:#50fa7b">selectList</span>(<span style="color:#ff79c6">null</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">map</span>(dict <span style="color:#ff79c6">-&gt;</span> BeanUtil.<span style="color:#50fa7b">copyProperties</span>(dict, DictEeVo.<span style="color:#50fa7b">class</span>))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">collect</span>(Collectors.<span style="color:#50fa7b">toList</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>            EasyExcel.<span style="color:#50fa7b">write</span>(response.<span style="color:#50fa7b">getOutputStream</span>(),DictEeVo.<span style="color:#50fa7b">class</span>).<span style="color:#50fa7b">sheet</span>(<span style="color:#f1fa8c">&#34;dict&#34;</span>)
</span></span><span style="display:flex;"><span>                    .<span style="color:#50fa7b">doWrite</span>(dictEeVoList);
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#50fa7b">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(<span style="color:#f1fa8c">&#34;失败&#34;</span>,201);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p><strong>BeanUtil使用的是hutool的</strong></p>
<h3 id="数据字典导入">数据字典导入</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//**DictController**</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//导入数据字典接口</span>
</span></span><span style="display:flex;"><span>    @PostMapping(<span style="color:#f1fa8c">&#34;importData&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">importDict</span>(MultipartFile file) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> dictService.<span style="color:#50fa7b">importDict</span>(file);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//**DictServiceImpl**</span>
</span></span><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">importDict</span>(MultipartFile file) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>            EasyExcel.<span style="color:#50fa7b">read</span>(file.<span style="color:#50fa7b">getInputStream</span>(),DictEeVo.<span style="color:#50fa7b">class</span>,<span style="color:#ff79c6">new</span> DictListener(baseMapper))
</span></span><span style="display:flex;"><span>                    .<span style="color:#50fa7b">sheet</span>().<span style="color:#50fa7b">doRead</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#50fa7b">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(<span style="color:#f1fa8c">&#34;失败&#34;</span>,201);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//**listener -&gt; DictListener**</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">DictListener</span> <span style="color:#8be9fd;font-style:italic">extends</span> AnalysisEventListener<span style="color:#ff79c6">&lt;</span>DictEeVo<span style="color:#ff79c6">&gt;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> DictMapper dictMapper;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#50fa7b">DictListener</span>(DictMapper dictMapper) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">dictMapper</span> <span style="color:#ff79c6">=</span> dictMapper;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">invoke</span>(DictEeVo dictEeVo, AnalysisContext analysisContext) {
</span></span><span style="display:flex;"><span>        Dict dict <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Dict();
</span></span><span style="display:flex;"><span>        BeanUtil.<span style="color:#50fa7b">copyProperties</span>(dictEeVo, dict);
</span></span><span style="display:flex;"><span>        dictMapper.<span style="color:#50fa7b">insert</span>(dict);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">doAfterAllAnalysed</span>(AnalysisContext analysisContext) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="53-spring-cache--redis-缓存数据">5.3 Spring Cache + Redis 缓存数据</h2>
<h3 id="添加依赖">添加依赖</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#ff79c6">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#ff79c6">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="添加配置类">添加配置类</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@EnableCaching
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">RedisConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 自定义key规则
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> KeyGenerator <span style="color:#50fa7b">keyGenerator</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> KeyGenerator() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">public</span> Object <span style="color:#50fa7b">generate</span>(Object target, Method method, Object... params) {
</span></span><span style="display:flex;"><span>                StringBuilder sb <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> StringBuilder();
</span></span><span style="display:flex;"><span>                sb.<span style="color:#50fa7b">append</span>(target.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getName</span>());
</span></span><span style="display:flex;"><span>                sb.<span style="color:#50fa7b">append</span>(method.<span style="color:#50fa7b">getName</span>());
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">for</span> (Object obj : params) {
</span></span><span style="display:flex;"><span>                    sb.<span style="color:#50fa7b">append</span>(obj.<span style="color:#50fa7b">toString</span>());
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> sb.<span style="color:#50fa7b">toString</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 设置RedisTemplate规则
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @param redisConnectionFactory
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> RedisTemplate<span style="color:#ff79c6">&lt;</span>Object, Object<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">redisTemplate</span>(RedisConnectionFactory redisConnectionFactory) {
</span></span><span style="display:flex;"><span>        RedisTemplate<span style="color:#ff79c6">&lt;</span>Object, Object<span style="color:#ff79c6">&gt;</span> redisTemplate <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> RedisTemplate<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#50fa7b">setConnectionFactory</span>(redisConnectionFactory);
</span></span><span style="display:flex;"><span>        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Jackson2JsonRedisSerializer(Object.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//解决查询缓存转换异常的问题</span>
</span></span><span style="display:flex;"><span>        ObjectMapper om <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ObjectMapper();
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 指定要序列化的域，field,get和set,以及修饰符范围，ANY是都有包括private和public</span>
</span></span><span style="display:flex;"><span>        om.<span style="color:#50fa7b">setVisibility</span>(PropertyAccessor.<span style="color:#50fa7b">ALL</span>, JsonAutoDetect.<span style="color:#50fa7b">Visibility</span>.<span style="color:#50fa7b">ANY</span>);
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 指定序列化输入的类型，类必须是非final修饰的，final修饰的类，比如String,Integer等会跑出异常</span>
</span></span><span style="display:flex;"><span>        om.<span style="color:#50fa7b">enableDefaultTyping</span>(ObjectMapper.<span style="color:#50fa7b">DefaultTyping</span>.<span style="color:#50fa7b">NON_FINAL</span>);
</span></span><span style="display:flex;"><span>        jackson2JsonRedisSerializer.<span style="color:#50fa7b">setObjectMapper</span>(om);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//序列号key value</span>
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#50fa7b">setKeySerializer</span>(<span style="color:#ff79c6">new</span> StringRedisSerializer());
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#50fa7b">setValueSerializer</span>(jackson2JsonRedisSerializer);
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#50fa7b">setHashKeySerializer</span>(<span style="color:#ff79c6">new</span> StringRedisSerializer());
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#50fa7b">setHashValueSerializer</span>(jackson2JsonRedisSerializer);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        redisTemplate.<span style="color:#50fa7b">afterPropertiesSet</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> redisTemplate;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 设置CacheManager缓存规则
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @param factory
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> CacheManager <span style="color:#50fa7b">cacheManager</span>(RedisConnectionFactory factory) {
</span></span><span style="display:flex;"><span>        RedisSerializer<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">&gt;</span> redisSerializer <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> StringRedisSerializer();
</span></span><span style="display:flex;"><span>        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Jackson2JsonRedisSerializer(Object.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//解决查询缓存转换异常的问题</span>
</span></span><span style="display:flex;"><span>        ObjectMapper om <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ObjectMapper();
</span></span><span style="display:flex;"><span>        om.<span style="color:#50fa7b">setVisibility</span>(PropertyAccessor.<span style="color:#50fa7b">ALL</span>, JsonAutoDetect.<span style="color:#50fa7b">Visibility</span>.<span style="color:#50fa7b">ANY</span>);
</span></span><span style="display:flex;"><span>        om.<span style="color:#50fa7b">enableDefaultTyping</span>(ObjectMapper.<span style="color:#50fa7b">DefaultTyping</span>.<span style="color:#50fa7b">NON_FINAL</span>);
</span></span><span style="display:flex;"><span>        jackson2JsonRedisSerializer.<span style="color:#50fa7b">setObjectMapper</span>(om);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 配置序列化（解决乱码的问题）,过期时间600秒</span>
</span></span><span style="display:flex;"><span>        RedisCacheConfiguration config <span style="color:#ff79c6">=</span> RedisCacheConfiguration.<span style="color:#50fa7b">defaultCacheConfig</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">entryTtl</span>(Duration.<span style="color:#50fa7b">ofSeconds</span>(600))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">serializeKeysWith</span>(RedisSerializationContext.<span style="color:#50fa7b">SerializationPair</span>.<span style="color:#50fa7b">fromSerializer</span>(redisSerializer))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">serializeValuesWith</span>(RedisSerializationContext.<span style="color:#50fa7b">SerializationPair</span>.<span style="color:#50fa7b">fromSerializer</span>(jackson2JsonRedisSerializer))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">disableCachingNullValues</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        RedisCacheManager cacheManager <span style="color:#ff79c6">=</span> RedisCacheManager.<span style="color:#50fa7b">builder</span>(factory)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">cacheDefaults</span>(config)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">build</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> cacheManager;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="添加redis配置">添加redis配置</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>spring.redis.host=localhost
</span></span><span style="display:flex;"><span>spring.redis.port=6379
</span></span><span style="display:flex;"><span>spring.redis.database= 0
</span></span><span style="display:flex;"><span>spring.redis.timeout=1800000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>spring.redis.lettuce.pool.max-active=20
</span></span><span style="display:flex;"><span>spring.redis.lettuce.pool.max-wait=-1
</span></span><span style="display:flex;"><span>spring.redis.lettuce.pool.max-idle=5
</span></span><span style="display:flex;"><span>spring.redis.lettuce.pool.min-idle=0
</span></span></code></pre></div><h3 id="使用spring-cache">使用Spring Cache</h3>
<h4 id="常用缓存标签">常用缓存标签</h4>
<ul>
<li>
<p><strong>@Cacheable</strong>：根据方法对其返回结果进行缓存，下次请求时，如果缓存存在，则直接读取缓存数据返回；如果缓存不存在，则执行方法，并把返回的结果存入缓存中。一般用在查询方法上。</p>
</li>
<li>
<p><strong>@CachePut</strong>：使用该注解标志的方法，每次都会执行，并将结果存入指定的缓存中。其他方法可以直接从响应的缓存中读取缓存数据，而不需要再去查询数据库。一般用在新增方法上。</p>
</li>
<li>
<p><strong>@CacheEvict</strong>：使用该注解标志的方法，会清空指定的缓存。一般用在更新或者删除方法上。</p>
</li>
</ul>
<h4 id="应用">应用</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span>@Cacheable(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;dict&#34;</span>,keyGenerator <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;keyGenerator&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> List<span style="color:#ff79c6">&lt;</span>Dict<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">findChildData</span>(Long id) {
</span></span><span style="display:flex;"><span>    QueryWrapper<span style="color:#ff79c6">&lt;</span>Dict<span style="color:#ff79c6">&gt;</span> wrapper <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> QueryWrapper<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    wrapper.<span style="color:#50fa7b">eq</span>(<span style="color:#f1fa8c">&#34;parent_id&#34;</span>,id);
</span></span><span style="display:flex;"><span>    List<span style="color:#ff79c6">&lt;</span>Dict<span style="color:#ff79c6">&gt;</span> dictList <span style="color:#ff79c6">=</span> baseMapper.<span style="color:#50fa7b">selectList</span>(wrapper).<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">map</span>(dict <span style="color:#ff79c6">-&gt;</span> {
</span></span><span style="display:flex;"><span>        Long dictId <span style="color:#ff79c6">=</span> dict.<span style="color:#50fa7b">getId</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">boolean</span> isChild <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">isChildren</span>(dictId);
</span></span><span style="display:flex;"><span>        dict.<span style="color:#50fa7b">setHasChildren</span>(isChild);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> dict;
</span></span><span style="display:flex;"><span>    }).<span style="color:#50fa7b">collect</span>(Collectors.<span style="color:#50fa7b">toList</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> dictList;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span>@CacheEvict(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;dict&#34;</span>, allEntries <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">importDict</span>(MultipartFile file) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>        EasyExcel.<span style="color:#50fa7b">read</span>(file.<span style="color:#50fa7b">getInputStream</span>(),DictEeVo.<span style="color:#50fa7b">class</span>,<span style="color:#ff79c6">new</span> DictListener(baseMapper))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">sheet</span>().<span style="color:#50fa7b">doRead</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#ff79c6">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#50fa7b">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(<span style="color:#f1fa8c">&#34;失败&#34;</span>,201);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="6-nginx">6. Nginx</h1>
<h1 id="7-mongodb">7. MongoDB</h1>
<h1 id="8-数据接口">8. 数据接口</h1>
<p><strong>ApiController</strong></p>
<h2 id="81-上传医院">8.1 上传医院</h2>
<h3 id="hospital实体类">hospital实体类</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span>@ApiModel(description <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Hospital&#34;</span>)
</span></span><span style="display:flex;"><span>@Document(<span style="color:#f1fa8c">&#34;Hospital&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Hospital</span> <span style="color:#8be9fd;font-style:italic">extends</span> BaseMongoEntity {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">long</span> serialVersionUID <span style="color:#ff79c6">=</span> 1L;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院编号&#34;</span>)
</span></span><span style="display:flex;"><span>   @Indexed(unique <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>) <span style="color:#6272a4">//唯一索引</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String hoscode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院名称&#34;</span>)
</span></span><span style="display:flex;"><span>   @Indexed <span style="color:#6272a4">//普通索引</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String hosname;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院类型&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String hostype;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;省code&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String provinceCode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;市code&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String cityCode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;区code&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String districtCode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;详情地址&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String address;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院logo&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String logoData;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院简介&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String intro;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;坐车路线&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String route;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;状态 0：未上线 1：已上线&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> Integer status;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">//预约规则</span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;预约规则&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> BookingRule bookingRule;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setBookingRule</span>(String bookingRule) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">bookingRule</span> <span style="color:#ff79c6">=</span> JSONObject.<span style="color:#50fa7b">parseObject</span>(bookingRule, BookingRule.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="功能实现">功能实现</h3>
<p>// <strong>ApiController</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//上传医院接口</span>
</span></span><span style="display:flex;"><span>@PostMapping(<span style="color:#f1fa8c">&#34;saveHospital&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">saveHosp</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//获取传递过来医院信息</span>
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">[]&gt;</span> requestMap <span style="color:#ff79c6">=</span> request.<span style="color:#50fa7b">getParameterMap</span>();
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap <span style="color:#ff79c6">=</span> HttpRequestHelper.<span style="color:#50fa7b">switchMap</span>(requestMap);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//1 获取医院系统传递过来的签名,签名进行MD5加密</span>
</span></span><span style="display:flex;"><span>    String hospSign <span style="color:#ff79c6">=</span> (String)paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;sign&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//2 根据传递过来医院编码，查询数据库，查询签名</span>
</span></span><span style="display:flex;"><span>    String hoscode <span style="color:#ff79c6">=</span> (String)paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>);
</span></span><span style="display:flex;"><span>    String signKey <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">getSignKey</span>(hoscode);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//3 把数据库查询签名进行MD5加密</span>
</span></span><span style="display:flex;"><span>    String signKeyMd5 <span style="color:#ff79c6">=</span> MD5.<span style="color:#50fa7b">encrypt</span>(signKey);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//4 判断签名是否一致</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!</span>hospSign.<span style="color:#50fa7b">equals</span>(signKeyMd5)) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(ResultCodeEnum.<span style="color:#50fa7b">SIGN_ERROR</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//传输过程中“+”转换为了“ ”，因此我们要转换回来</span>
</span></span><span style="display:flex;"><span>    String logoData <span style="color:#ff79c6">=</span> (String)paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;logoData&#34;</span>);
</span></span><span style="display:flex;"><span>    logoData <span style="color:#ff79c6">=</span> logoData.<span style="color:#50fa7b">replaceAll</span>(<span style="color:#f1fa8c">&#34; &#34;</span>,<span style="color:#f1fa8c">&#34;+&#34;</span>);
</span></span><span style="display:flex;"><span>    paramMap.<span style="color:#50fa7b">put</span>(<span style="color:#f1fa8c">&#34;logoData&#34;</span>,logoData);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//调用service的方法</span>
</span></span><span style="display:flex;"><span>    hospitalService.<span style="color:#50fa7b">save</span>(paramMap);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>// <strong>HospitalServiceImpl</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Service
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">HospitalServiceImpl</span> <span style="color:#8be9fd;font-style:italic">implements</span> HospitalService {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> HospitalRepository hospitalRepository;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">save</span>(Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//把参数map集合转换对象 Hospital</span>
</span></span><span style="display:flex;"><span>        String jsonString <span style="color:#ff79c6">=</span> JSONObject.<span style="color:#50fa7b">toJSONString</span>(paramMap);
</span></span><span style="display:flex;"><span>        Hospital hospital <span style="color:#ff79c6">=</span> JSONObject.<span style="color:#50fa7b">parseObject</span>(jsonString, Hospital.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//判断是否存在数据</span>
</span></span><span style="display:flex;"><span>        String hoscode <span style="color:#ff79c6">=</span> hospital.<span style="color:#50fa7b">getHoscode</span>();
</span></span><span style="display:flex;"><span>        Hospital hospitalExist <span style="color:#ff79c6">=</span> hospitalRepository.<span style="color:#50fa7b">getHospitalByHoscode</span>(hoscode);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//如果存在，进行修改</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (hospitalExist <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            hospital.<span style="color:#50fa7b">setStatus</span>(hospital.<span style="color:#50fa7b">getStatus</span>());
</span></span><span style="display:flex;"><span>            hospital.<span style="color:#50fa7b">setCreateTime</span>(hospital.<span style="color:#50fa7b">getCreateTime</span>());
</span></span><span style="display:flex;"><span>            hospital.<span style="color:#50fa7b">setUpdateTime</span>(<span style="color:#ff79c6">new</span> Date());
</span></span><span style="display:flex;"><span>            hospital.<span style="color:#50fa7b">setIsDeleted</span>(0);
</span></span><span style="display:flex;"><span>            hospitalRepository.<span style="color:#50fa7b">save</span>(hospital);
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">else</span> {<span style="color:#6272a4">//如果不存在，进行添加</span>
</span></span><span style="display:flex;"><span>            hospital.<span style="color:#50fa7b">setStatus</span>(0);
</span></span><span style="display:flex;"><span>            hospital.<span style="color:#50fa7b">setCreateTime</span>(<span style="color:#ff79c6">new</span> Date());
</span></span><span style="display:flex;"><span>            hospital.<span style="color:#50fa7b">setUpdateTime</span>(<span style="color:#ff79c6">new</span> Date());
</span></span><span style="display:flex;"><span>            hospital.<span style="color:#50fa7b">setIsDeleted</span>(0);
</span></span><span style="display:flex;"><span>            hospitalRepository.<span style="color:#50fa7b">save</span>(hospital);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>// <strong>HospitalSetServiceImpl</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">getSignKey</span>(String hoscode) {
</span></span><span style="display:flex;"><span>    QueryWrapper<span style="color:#ff79c6">&lt;</span>HospitalSet<span style="color:#ff79c6">&gt;</span> wrapper <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> QueryWrapper<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    wrapper.<span style="color:#50fa7b">eq</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>,hoscode);
</span></span><span style="display:flex;"><span>    HospitalSet hospitalSet <span style="color:#ff79c6">=</span> baseMapper.<span style="color:#50fa7b">selectOne</span>(wrapper);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (hospitalSet <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(ResultCodeEnum.<span style="color:#50fa7b">FAIL</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> hospitalSet.<span style="color:#50fa7b">getSignKey</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="82-查询医院">8.2 查询医院</h2>
<h3 id="功能实现-1">功能实现</h3>
<p>// <strong>ApiController</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@GetMapping(<span style="color:#f1fa8c">&#34;hospital/show&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">getHosp</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">[]&gt;</span> parameterMap <span style="color:#ff79c6">=</span> request.<span style="color:#50fa7b">getParameterMap</span>();
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap <span style="color:#ff79c6">=</span> HttpRequestHelper.<span style="color:#50fa7b">switchMap</span>(parameterMap);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String hospSign <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;sign&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String hoscode <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>);
</span></span><span style="display:flex;"><span>    String signKey <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">getSignKey</span>(hoscode);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String signKeyMD5 <span style="color:#ff79c6">=</span> MD5.<span style="color:#50fa7b">encrypt</span>(signKey);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>hospSign.<span style="color:#50fa7b">equals</span>(signKeyMD5)) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(ResultCodeEnum.<span style="color:#50fa7b">SIGN_ERROR</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Hospital hospital <span style="color:#ff79c6">=</span> hospitalService.<span style="color:#50fa7b">getByHoscode</span>(hoscode);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>(hospital);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>// <strong>HospitalServiceImpl</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Hospital <span style="color:#50fa7b">getByHoscode</span>(String hoscode) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Hospital hospital <span style="color:#ff79c6">=</span> hospitalRepository.<span style="color:#50fa7b">getHospitalByHoscode</span>(hoscode);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> hospital;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="83-上传科室">8.3 上传科室</h2>
<h3 id="department实体类">Department实体类</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Data
</span></span><span style="display:flex;"><span>@ApiModel(description <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Department&#34;</span>)
</span></span><span style="display:flex;"><span>@Document(<span style="color:#f1fa8c">&#34;Department&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Department</span> <span style="color:#8be9fd;font-style:italic">extends</span> BaseMongoEntity {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">long</span> serialVersionUID <span style="color:#ff79c6">=</span> 1L;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院编号&#34;</span>)
</span></span><span style="display:flex;"><span>   @Indexed <span style="color:#6272a4">//普通索引</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String hoscode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;科室编号&#34;</span>)
</span></span><span style="display:flex;"><span>   @Indexed(unique <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>) <span style="color:#6272a4">//唯一索引</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String depcode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;科室名称&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String depname;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;科室描述&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String intro;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;大科室编号&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String bigcode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;大科室名称&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String bigname;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="功能实现-2">功能实现</h3>
<p>// <strong>ApiController</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@PostMapping(<span style="color:#f1fa8c">&#34;saveDepartment&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">saveDepartment</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">[]&gt;</span> parameterMap <span style="color:#ff79c6">=</span> request.<span style="color:#50fa7b">getParameterMap</span>();
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap <span style="color:#ff79c6">=</span> HttpRequestHelper.<span style="color:#50fa7b">switchMap</span>(parameterMap);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String hospSign <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;sign&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String hoscode <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>);
</span></span><span style="display:flex;"><span>    String signKey <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">getSignKey</span>(hoscode);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String signKeyMD5 <span style="color:#ff79c6">=</span> MD5.<span style="color:#50fa7b">encrypt</span>(signKey);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>hospSign.<span style="color:#50fa7b">equals</span>(signKeyMD5)) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(ResultCodeEnum.<span style="color:#50fa7b">SIGN_ERROR</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> departmentService.<span style="color:#50fa7b">saveDepartment</span>(paramMap);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>// <strong>DepartmentServiceImpl</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">DepartmentServiceImpl</span> <span style="color:#8be9fd;font-style:italic">implements</span> DepartmentService {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> DepartmentRepository departmentRepository;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">saveDepartment</span>(Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String paramMapString <span style="color:#ff79c6">=</span> JSONObject.<span style="color:#50fa7b">toJSONString</span>(paramMap);
</span></span><span style="display:flex;"><span>        Department department <span style="color:#ff79c6">=</span> JSONObject.<span style="color:#50fa7b">parseObject</span>(paramMapString, Department.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Department departmentExist <span style="color:#ff79c6">=</span> departmentRepository.<span style="color:#50fa7b">getDepartmentByHoscodeAndDepcode</span>(department.<span style="color:#50fa7b">getHoscode</span>(),department.<span style="color:#50fa7b">getDepcode</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span>(departmentExist<span style="color:#ff79c6">!=</span><span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            department.<span style="color:#50fa7b">setUpdateTime</span>(<span style="color:#ff79c6">new</span> Date());
</span></span><span style="display:flex;"><span>            department.<span style="color:#50fa7b">setIsDeleted</span>(0);
</span></span><span style="display:flex;"><span>            departmentRepository.<span style="color:#50fa7b">save</span>(department);
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>            department.<span style="color:#50fa7b">setCreateTime</span>(<span style="color:#ff79c6">new</span> Date());
</span></span><span style="display:flex;"><span>            department.<span style="color:#50fa7b">setUpdateTime</span>(<span style="color:#ff79c6">new</span> Date());
</span></span><span style="display:flex;"><span>            department.<span style="color:#50fa7b">setIsDeleted</span>(0);
</span></span><span style="display:flex;"><span>            departmentRepository.<span style="color:#50fa7b">save</span>(department);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="84-分页查询科室">8.4 分页查询科室</h2>
<h3 id="功能实现-3">功能实现</h3>
<p>// ApiController</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@PostMapping(<span style="color:#f1fa8c">&#34;department/list&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">findDepartment</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">[]&gt;</span> parameterMap <span style="color:#ff79c6">=</span> request.<span style="color:#50fa7b">getParameterMap</span>();
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap <span style="color:#ff79c6">=</span> HttpRequestHelper.<span style="color:#50fa7b">switchMap</span>(parameterMap);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String hoscode <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String sign <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;sign&#34;</span>);
</span></span><span style="display:flex;"><span>    String signKey <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">getSignKey</span>(hoscode);
</span></span><span style="display:flex;"><span>    String signKeyMD5 <span style="color:#ff79c6">=</span> MD5.<span style="color:#50fa7b">encrypt</span>(signKey);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>sign.<span style="color:#50fa7b">equals</span>(signKeyMD5)) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(ResultCodeEnum.<span style="color:#50fa7b">SIGN_ERROR</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> page <span style="color:#ff79c6">=</span> StringUtils.<span style="color:#50fa7b">isEmpty</span>(paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;page&#34;</span>)) <span style="color:#ff79c6">?</span> 1 : Integer.<span style="color:#50fa7b">parseInt</span>((String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;page&#34;</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> limit <span style="color:#ff79c6">=</span> StringUtils.<span style="color:#50fa7b">isEmpty</span>(paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;limit&#34;</span>)) <span style="color:#ff79c6">?</span> 1 : Integer.<span style="color:#50fa7b">parseInt</span>((String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;limit&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    DepartmentQueryVo departmentQueryVo <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> DepartmentQueryVo();
</span></span><span style="display:flex;"><span>    departmentQueryVo.<span style="color:#50fa7b">setHoscode</span>(hoscode);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Page<span style="color:#ff79c6">&lt;</span>Department<span style="color:#ff79c6">&gt;</span> pageModel <span style="color:#ff79c6">=</span> departmentService.<span style="color:#50fa7b">findPageDepartment</span>(page,limit,departmentQueryVo);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>(pageModel);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>// DepartmentSeriviceImpl</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Page<span style="color:#ff79c6">&lt;</span>Department<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">findPageDepartment</span>(<span style="color:#8be9fd">int</span> page, <span style="color:#8be9fd">int</span> limit, DepartmentQueryVo departmentQueryVo) {
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//分页参数</span>
</span></span><span style="display:flex;"><span>    Pageable pageable <span style="color:#ff79c6">=</span> PageRequest.<span style="color:#50fa7b">of</span>(page<span style="color:#ff79c6">-</span>1,limit);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Department department <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Department();
</span></span><span style="display:flex;"><span>    BeanUtils.<span style="color:#50fa7b">copyProperties</span>(departmentQueryVo,department);
</span></span><span style="display:flex;"><span>    department.<span style="color:#50fa7b">setIsDeleted</span>(0);
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//条件</span>
</span></span><span style="display:flex;"><span>    ExampleMatcher exampleMatcher <span style="color:#ff79c6">=</span> ExampleMatcher.<span style="color:#50fa7b">matching</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">withStringMatcher</span>(ExampleMatcher.<span style="color:#50fa7b">StringMatcher</span>.<span style="color:#50fa7b">CONTAINING</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">withIgnoreCase</span>(<span style="color:#ff79c6">true</span>);
</span></span><span style="display:flex;"><span>    Example<span style="color:#ff79c6">&lt;</span>Department<span style="color:#ff79c6">&gt;</span> example <span style="color:#ff79c6">=</span> Example.<span style="color:#50fa7b">of</span>(department,exampleMatcher);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Page<span style="color:#ff79c6">&lt;</span>Department<span style="color:#ff79c6">&gt;</span> pageAll <span style="color:#ff79c6">=</span> departmentRepository.<span style="color:#50fa7b">findAll</span>(example, pageable);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> pageAll;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="85-删除科室">8.5 删除科室</h2>
<h3 id="功能实现-4">功能实现</h3>
<p>// ApiController</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@PostMapping(<span style="color:#f1fa8c">&#34;department/remove&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">removeDepartment</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">[]&gt;</span> parameterMap <span style="color:#ff79c6">=</span> request.<span style="color:#50fa7b">getParameterMap</span>();
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap <span style="color:#ff79c6">=</span> HttpRequestHelper.<span style="color:#50fa7b">switchMap</span>(parameterMap);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String hoscode <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>);
</span></span><span style="display:flex;"><span>    String depcode <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;depcode&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String sign <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;sign&#34;</span>);
</span></span><span style="display:flex;"><span>    String signKey <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">getSignKey</span>(hoscode);
</span></span><span style="display:flex;"><span>    String signKeyMD5 <span style="color:#ff79c6">=</span> MD5.<span style="color:#50fa7b">encrypt</span>(signKey);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>sign.<span style="color:#50fa7b">equals</span>(signKeyMD5)) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(ResultCodeEnum.<span style="color:#50fa7b">SIGN_ERROR</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> departmentService.<span style="color:#50fa7b">remove</span>(hoscode,depcode);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>// DepartmentSeriviceImpl</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">remove</span>(String hoscode, String depcode) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Department department <span style="color:#ff79c6">=</span> departmentRepository.<span style="color:#50fa7b">getDepartmentByHoscodeAndDepcode</span>(hoscode, depcode);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (department <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    departmentRepository.<span style="color:#50fa7b">deleteById</span>(department.<span style="color:#50fa7b">getId</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="86-上传查询删除排班">8.6 上传、查询、删除排班</h2>
<h3 id="schedule实体类">Schedule实体类</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span>@ApiModel(description <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Schedule&#34;</span>)
</span></span><span style="display:flex;"><span>@Document(<span style="color:#f1fa8c">&#34;Schedule&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Schedule</span> <span style="color:#8be9fd;font-style:italic">extends</span> BaseMongoEntity {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> <span style="color:#8be9fd">long</span> serialVersionUID <span style="color:#ff79c6">=</span> 1L;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院编号&#34;</span>)
</span></span><span style="display:flex;"><span>   @Indexed <span style="color:#6272a4">//普通索引</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String hoscode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;科室编号&#34;</span>)
</span></span><span style="display:flex;"><span>   @Indexed <span style="color:#6272a4">//普通索引</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String depcode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;职称&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String title;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医生名称&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String docname;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;擅长技能&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String skill;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;排班日期&#34;</span>)
</span></span><span style="display:flex;"><span>   @JsonFormat(pattern <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;yyyy-MM-dd&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> Date workDate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;排班时间（0：上午 1：下午）&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> Integer workTime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;可预约数&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> Integer reservedNumber;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;剩余预约数&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> Integer availableNumber;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;挂号费&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> BigDecimal amount;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;排班状态（-1：停诊 0：停约 1：可约）&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> Integer status;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;排班编号（医院自己的排班主键）&#34;</span>)
</span></span><span style="display:flex;"><span>   @Indexed <span style="color:#6272a4">//普通索引</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String hosScheduleId;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="schedulequeryvo实体类">ScheduleQueryVo实体类</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Data
</span></span><span style="display:flex;"><span>@ApiModel(description <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Schedule&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">ScheduleQueryVo</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医院编号&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String hoscode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;科室编号&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String depcode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;医生编号&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> String doccode;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;安排日期&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> Date workDate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   @ApiModelProperty(value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;安排时间（0：上午 1：下午）&#34;</span>)
</span></span><span style="display:flex;"><span>   <span style="color:#8be9fd;font-style:italic">private</span> Integer workTime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="功能实现-5">功能实现</h3>
<p>// ApiController</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">//上传排班接口</span>
</span></span><span style="display:flex;"><span>@PostMapping(<span style="color:#f1fa8c">&#34;saveSchedule&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">saveSchedule</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">[]&gt;</span> parameterMap <span style="color:#ff79c6">=</span> request.<span style="color:#50fa7b">getParameterMap</span>();
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap <span style="color:#ff79c6">=</span> HttpRequestHelper.<span style="color:#50fa7b">switchMap</span>(parameterMap);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String hoscode <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String sign <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;sign&#34;</span>);
</span></span><span style="display:flex;"><span>    String signKey <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">getSignKey</span>(hoscode);
</span></span><span style="display:flex;"><span>    String signKeyMD5 <span style="color:#ff79c6">=</span> MD5.<span style="color:#50fa7b">encrypt</span>(signKey);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>sign.<span style="color:#50fa7b">equals</span>(signKeyMD5)) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(ResultCodeEnum.<span style="color:#50fa7b">SIGN_ERROR</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> scheduleService.<span style="color:#50fa7b">save</span>(paramMap);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//查询排班接口</span>
</span></span><span style="display:flex;"><span>@PostMapping(<span style="color:#f1fa8c">&#34;schedule/list&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">findSchedule</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">[]&gt;</span> parameterMap <span style="color:#ff79c6">=</span> request.<span style="color:#50fa7b">getParameterMap</span>();
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap <span style="color:#ff79c6">=</span> HttpRequestHelper.<span style="color:#50fa7b">switchMap</span>(parameterMap);
</span></span><span style="display:flex;"><span>    String hoscode <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>);
</span></span><span style="display:flex;"><span>    String sign <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;sign&#34;</span>);
</span></span><span style="display:flex;"><span>    String signKey <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">getSignKey</span>(hoscode);
</span></span><span style="display:flex;"><span>    String signKeyMD5 <span style="color:#ff79c6">=</span> MD5.<span style="color:#50fa7b">encrypt</span>(signKey);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>sign.<span style="color:#50fa7b">equals</span>(signKeyMD5)) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(ResultCodeEnum.<span style="color:#50fa7b">SIGN_ERROR</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String depcode <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;depcode&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> page <span style="color:#ff79c6">=</span> StringUtils.<span style="color:#50fa7b">isEmpty</span>(paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;page&#34;</span>)) <span style="color:#ff79c6">?</span> 1 : Integer.<span style="color:#50fa7b">parseInt</span>((String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;page&#34;</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> limit <span style="color:#ff79c6">=</span> StringUtils.<span style="color:#50fa7b">isEmpty</span>(paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;limit&#34;</span>)) <span style="color:#ff79c6">?</span> 1 : Integer.<span style="color:#50fa7b">parseInt</span>((String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;limit&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ScheduleQueryVo scheduleQueryVo <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ScheduleQueryVo();
</span></span><span style="display:flex;"><span>    scheduleQueryVo.<span style="color:#50fa7b">setHoscode</span>(hoscode);
</span></span><span style="display:flex;"><span>    scheduleQueryVo.<span style="color:#50fa7b">setDepcode</span>(depcode);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Page<span style="color:#ff79c6">&lt;</span>Schedule<span style="color:#ff79c6">&gt;</span> pageModel <span style="color:#ff79c6">=</span> scheduleService.<span style="color:#50fa7b">findPageSchedule</span>(page,limit,scheduleQueryVo);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>(pageModel);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//删除排班</span>
</span></span><span style="display:flex;"><span>@PostMapping(<span style="color:#f1fa8c">&#34;schedule/remove&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">remove</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">[]&gt;</span> parameterMap <span style="color:#ff79c6">=</span> request.<span style="color:#50fa7b">getParameterMap</span>();
</span></span><span style="display:flex;"><span>    Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap <span style="color:#ff79c6">=</span> HttpRequestHelper.<span style="color:#50fa7b">switchMap</span>(parameterMap);
</span></span><span style="display:flex;"><span>    String hoscode <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;hoscode&#34;</span>);
</span></span><span style="display:flex;"><span>    String sign <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;sign&#34;</span>);
</span></span><span style="display:flex;"><span>    String signKey <span style="color:#ff79c6">=</span> hospitalSetService.<span style="color:#50fa7b">getSignKey</span>(hoscode);
</span></span><span style="display:flex;"><span>    String signKeyMD5 <span style="color:#ff79c6">=</span> MD5.<span style="color:#50fa7b">encrypt</span>(signKey);
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>sign.<span style="color:#50fa7b">equals</span>(signKeyMD5)) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> YyghException(ResultCodeEnum.<span style="color:#50fa7b">SIGN_ERROR</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String hosScheduleId <span style="color:#ff79c6">=</span> (String) paramMap.<span style="color:#50fa7b">get</span>(<span style="color:#f1fa8c">&#34;hosScheduleId&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> scheduleService.<span style="color:#50fa7b">remove</span>(hoscode,hosScheduleId);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>// ScheduleServiceImpl</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Service
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">ScheduleServiceImpl</span> <span style="color:#8be9fd;font-style:italic">implements</span> ScheduleService {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> ScheduleRepository scheduleRepository;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">save</span>(Map<span style="color:#ff79c6">&lt;</span>String, Object<span style="color:#ff79c6">&gt;</span> paramMap) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String paramString <span style="color:#ff79c6">=</span> JSONObject.<span style="color:#50fa7b">toJSONString</span>(paramMap);
</span></span><span style="display:flex;"><span>        Schedule schedule <span style="color:#ff79c6">=</span> JSONObject.<span style="color:#50fa7b">parseObject</span>(paramString, Schedule.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Schedule scheduleExist <span style="color:#ff79c6">=</span> scheduleRepository.<span style="color:#50fa7b">getScheduleByHoscodeAndHosScheduleId</span>(schedule.<span style="color:#50fa7b">getHoscode</span>(),schedule.<span style="color:#50fa7b">getHosScheduleId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (scheduleExist <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            schedule.<span style="color:#50fa7b">setUpdateTime</span>(<span style="color:#ff79c6">new</span> Date());
</span></span><span style="display:flex;"><span>            schedule.<span style="color:#50fa7b">setIsDeleted</span>(0);
</span></span><span style="display:flex;"><span>            schedule.<span style="color:#50fa7b">setStatus</span>(1);
</span></span><span style="display:flex;"><span>            scheduleRepository.<span style="color:#50fa7b">save</span>(schedule);
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>            schedule.<span style="color:#50fa7b">setCreateTime</span>(<span style="color:#ff79c6">new</span> Date());
</span></span><span style="display:flex;"><span>            schedule.<span style="color:#50fa7b">setUpdateTime</span>(<span style="color:#ff79c6">new</span> Date());
</span></span><span style="display:flex;"><span>            schedule.<span style="color:#50fa7b">setIsDeleted</span>(0);
</span></span><span style="display:flex;"><span>            schedule.<span style="color:#50fa7b">setStatus</span>(1);
</span></span><span style="display:flex;"><span>            scheduleRepository.<span style="color:#50fa7b">save</span>(schedule);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Page<span style="color:#ff79c6">&lt;</span>Schedule<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">findPageSchedule</span>(<span style="color:#8be9fd">int</span> page, <span style="color:#8be9fd">int</span> limit, ScheduleQueryVo scheduleQueryVo) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Pageable pageable <span style="color:#ff79c6">=</span> PageRequest.<span style="color:#50fa7b">of</span>(page<span style="color:#ff79c6">-</span>1,limit);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Schedule schedule <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Schedule();
</span></span><span style="display:flex;"><span>        BeanUtils.<span style="color:#50fa7b">copyProperties</span>(scheduleQueryVo,schedule);
</span></span><span style="display:flex;"><span>        schedule.<span style="color:#50fa7b">setIsDeleted</span>(0);
</span></span><span style="display:flex;"><span>        schedule.<span style="color:#50fa7b">setStatus</span>(1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ExampleMatcher matcher <span style="color:#ff79c6">=</span> ExampleMatcher.<span style="color:#50fa7b">matching</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">withStringMatcher</span>(ExampleMatcher.<span style="color:#50fa7b">StringMatcher</span>.<span style="color:#50fa7b">CONTAINING</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">withIgnoreCase</span>(<span style="color:#ff79c6">true</span>);
</span></span><span style="display:flex;"><span>        Example<span style="color:#ff79c6">&lt;</span>Schedule<span style="color:#ff79c6">&gt;</span> example <span style="color:#ff79c6">=</span> Example.<span style="color:#50fa7b">of</span>(schedule,matcher);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Page<span style="color:#ff79c6">&lt;</span>Schedule<span style="color:#ff79c6">&gt;</span> pageModel <span style="color:#ff79c6">=</span> scheduleRepository.<span style="color:#50fa7b">findAll</span>(example,pageable);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> pageModel;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">remove</span>(String hoscode, String hosScheduleId) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Schedule schedule <span style="color:#ff79c6">=</span> scheduleRepository.<span style="color:#50fa7b">getScheduleByHoscodeAndHosScheduleId</span>(hoscode, hosScheduleId);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (schedule <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">fail</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        scheduleRepository.<span style="color:#50fa7b">deleteById</span>(schedule.<span style="color:#50fa7b">getId</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result.<span style="color:#50fa7b">ok</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>

                
                
<div class="entry-shang text-center">
    
	    <p>「真诚赞赏，手留余香」</p>
	
	<button class="zs show-zs btn btn-bred">赞赏支持</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">×</button>
		<span class="author"><a href="http://localhost:1313/"><img src="/img/favicon.png" />SleepingFace Blog</a></span>
        
	        <p class="tip"><i></i><span>真诚赞赏，手留余香</span></p>
		
 
	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2元</button>
			<button class="btn btn-blink" data-num="5">5元</button>
			<button class="btn btn-blink" data-num="10">10元</button>
			<button class="btn btn-blink" data-num="50">50元</button>
			<button class="btn btn-blink" data-num="100">100元</button>
			<button class="btn btn-blink" data-num="1">任意金额</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2元</button>
			<p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
			<img src="/img/reward/wechat-2.png"  id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
		<label><input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked"><span ><span class="zs-wechat"><img src="/img/reward/wechat-btn.png"/></span></label>
		<label><input type="radio" name="zs-type" value="alipay" class="zs-type" class="zs-alipay"><img src="/img/reward/alipay-btn.png"/></span></label>
	</div>
</div>
<script type="text/javascript" src="/js/reward.js"></script>

                

                
                <hr>
                <ul class="pager">
                    
                    
                    <li class="next">
                        <a href="/2024/07/22/leetcode-note/" data-toggle="tooltip" data-placement="top" title="代码随想录&#43;leetcode笔记">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

                


            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>FRIENDS</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="https://tanxiangyuu.github.io">谭总的博客</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:wangzhendong20@163.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/wangzhendong20">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="SleepingFace Blog" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
            
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; SleepingFace Blog 2024
                    
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                    
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body>
</html>
